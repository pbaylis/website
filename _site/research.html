<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Patrick Baylis - Research</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./img/favicon-camping.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Patrick Baylis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./research.html" aria-current="page"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./pdf/Baylis_CV.pdf"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./teaching.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./posts.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pbaylis"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/pbaylis"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#publications" id="toc-publications" class="nav-link active" data-scroll-target="#publications">Publications</a></li>
  <li><a href="#working-papers" id="toc-working-papers" class="nav-link" data-scroll-target="#working-papers">Working papers</a></li>
  <li><a href="#selected-work-in-progress" id="toc-selected-work-in-progress" class="nav-link" data-scroll-target="#selected-work-in-progress">Selected work in progress</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Research</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="publications" class="level2">
<h2 class="anchored" data-anchor-id="publications">Publications</h2>
<ul>
<li>Mandated vs.&nbsp;Voluntary Adaptation to Natural Disasters: The Case of U.S. Wildfires (with Judson Boomhower, accepted at the <em>Journal of Political Economy</em>)
<ul>
<li><a href="https://www.nber.org/papers/w29621">NBER Working Paper (December 2021)</a></li>
<li>Selected media: <a href="https://headwaterseconomics.org/natural-hazards/wildfire-suppression-costs-rising/">Headwaters Economics Blog Post</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.nytimes.com/2022/01/26/us/wildfire-development-california-legal.html">New York Times</a> <span class="math inline">\(\cdot\)</span> <a href="https://open.spotify.com/episode/69CT2YZ4JE0cOCuBJS0slX?si=25f2a86cf5594870">Marketplace</a> <span class="math inline">\(\cdot\)</span><a href="https://megaphone.link/VMP8825632497">The Weeds</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.marketwatch.com/story/enforcing-building-codes-in-california-helped-reduce-the-risk-of-structural-loss-in-a-wildfire-by-40-11641316060">Marketwatch</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.latimes.com/california/story/2022-01-28/california-wildfire-retrofits-rural-san-diego">LA Times</a></li>
</ul></li>
<li>Quantifying Fire-Specific Smoke Severity (with Jeff Wen, Marshall Burke, and Judson Boomhower, <em>Proceedings of the National Academy of Sciences</em>, 2023)
<ul>
<li><a href="https://www.pnas.org/doi/10.1073/pnas.2309325120">Paper</a> <span class="math inline">\(\cdot\)</span> <a href="https://eartharxiv.org/repository/view/5060/">Preprint</a></li>
<li>Selected media: <a href="https://www.nytimes.com/2023/05/17/opinion/wildfires-smoke-pollution-distance.html">New York Times 1</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.nytimes.com/2023/06/28/climate/tracing-wildfire-smoke-health.html">New York Times 2</a></li>
</ul></li>
<li>The Economic Incidence of Wildfire Suppression in the United States (with Judson Boomhower, previously titled “Moral Hazard, Wildfires, and the Economic Incidence of Natural Disasters,” <em>AEJ: Applied Economics</em>, 2023)
<ul>
<li><a href="https://www.aeaweb.org/articles?id=10.1257/app.20200662">Paper</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.nber.org/papers/w26550.pdf">NBER Working Paper</a></li>
</ul></li>
<li>Exposures and Behavioral Responses to Wildfire Smoke (with Marshall Burke, Sam Heft-Neal, Jessica Li, Anne Driscoll, Matthieu Stigler, Joakim Weill, Jennifer Burney, Jeff Wen, Marissa Childs, and Carlos Gould, <em>Nature: Human Behavior</em>, 2022)
<ul>
<li><a href="https://www.nature.com/articles/s41562-022-01396-6">Paper</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.nber.org/papers/w29380">NBER Working Paper</a></li>
</ul></li>
<li>Default Effects, Follow-on Behavior and Welfare in Residential Electricity Pricing Program (with Meredith Fowlie, Catherine Wolfram, C. Anna Spurlock, Annika Todd, and Peter Cappers, <em>The Review of Economic Studies</em>, 2021)
<ul>
<li><a href="https://academic.oup.com/restud/article-abstract/88/6/2886/6222168">Paper</a> <span class="math inline">\(\cdot\)</span> <a href="http://www.patrickbaylis.com/pdf/DefaultBias-NBER.pdf">NBER Working Paper</a></li>
</ul></li>
<li>The Distribution of COVID-19 Related Risks (with Pierre-Loup Beauregard, Marie Connolly, Nicole Fortin, David A. Green, Pablo Gutierrez Cubillos, Samuel S. Gyetvay, Catherine Haeck, Timea Laura Molnar, Gaëlle Simard-Duplain, Henry E. Siu, Maria teNyenhuis, and Casey Warman, <em>Canadian Journal of Economics</em>, 2021)
<ul>
<li><a href="https://onlinelibrary.wiley.com/doi/full/10.1111/caje.12540">Paper</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.nber.org/papers/w27881.pdf">NBER Working Paper</a> <span class="math inline">\(\cdot\)</span> <a href="https://ideas.repec.org/p/cir/cirwor/2020s-50.html">CIRANO Working Paper</a></li>
<li><a href="https://baylislab.shinyapps.io/vse-risk-tool/">VSE COVID Risk/Reward Assessment Tool</a> <span class="math inline">\(\cdot\)</span> <a href="https://github.com/pbaylis/vse-risk-tool">Repo</a></li>
</ul></li>
<li>Job Loss and Behavioral Change: The Unprecedented Effects of the India Lockdown in Delhi (with Kenneth Lee, Harshil Sahai, and Michael Greenstone, <em>COVID Economics</em>, 2021)
<ul>
<li><a href="https://cepr.org/system/files/publication-files/101403-covid_economics_issue_51.pdf#page=139">Paper</a> <span class="math inline">\(\cdot\)</span> <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3601979">SSRN Working Paper</a></li>
</ul></li>
<li>Temperature and Temperament: Evidence from Twitter (<em>Journal of Public Economics</em>, 2020)
<ul>
<li><a href="https://www.sciencedirect.com/science/article/abs/pii/S0047272720300256">Paper</a> <span class="math inline">\(\cdot\)</span> <a href="./pdf/Baylis_TT_Paper_and_Appendix_20191223.pdf">Pre-print</a></li>
<li>Selected media: <a href="https://www.popsci.com/science-confirms-obvious-we-hate-being-hot">Popular Science</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.washingtonpost.com/news/wonk/wp/2016/01/07/clear-evidence-that-cold-days-are-better-than-hot-ones/?noredirect=on&amp;utm_term=.1338bbea7602">Washington Post</a> <span class="math inline">\(\cdot\)</span> <a href="http://time.com/4172187/temperature-weather-hot-cold-preferences/">Time</a> <span class="math inline">\(\cdot\)</span> <a href="https://weather.com/health/news/weather-makes-us-more-miserable">Weather Channel</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.universityofcalifornia.edu/news/what-billion-tweets-tell-us-about-climate-change">UC Newsroom</a> <span class="math inline">\(\cdot\)</span> <a href="https://energyathaas.wordpress.com/2015/12/07/heat-and-happiness/">Energy Institute</a> <span class="math inline">\(\cdot\)</span> <a href="http://www.g-feed.com/2015/12/warming-makes-people-unhappy-evidence.html">G-FEED</a> <span class="math inline">\(\cdot\)</span> <a href="https://marginalrevolution.com/marginalrevolution/2016/01/do-you-get-grumpy-over-seventy-degrees-fahrenheit.html">Marginal Revolution</a></li>
</ul></li>
<li>Rapidly Declining Remarkability of Temperature Anomalies May Obscure Public Perception of Climate Change (with Frances C. Moore, Nick Obradovich, and Flavio Lehner, <em>Proceedings of the National Academy of Sciences</em>, 2019)
<ul>
<li><a href="https://www.pnas.org/content/early/2019/02/15/1816541116">Paper</a></li>
<li>Selected media: <a href="https://www.nytimes.com/2019/02/26/climate/what-is-extreme-weather.html">New York Times</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.washingtonpost.com/weather/2019/02/25/data-are-frogs-dont-boil-we-might/">Washington Post (op-ed by Moore and Obradovich)</a></li>
</ul></li>
<li>Higher Temperatures Increase Suicide Rates in the United States and Mexico (with Marshall Burke, Felipe González, Sam Heft-Neal, Ceren Baysan, Sanjay Basu, and Solomon Hsiang, <em>Nature Climate Change</em>, 2018)
<ul>
<li><a href="http://em.rdcu.be/wf/click?upn=lMZy1lernSJ7apc5DgYM8fLeFU9SBVNVGySwNPJsu0A-3D_VU3-2B-2F8HBchm5dOaNevIAhP-2FsrdBAPzAm0rA-2B8dYvjp91uIGUxuZMmROi-2F6Eqk2dEeDOjay71-2FPLqxjXPntLgbnr7aL7PFwk89m5mkkKJA85bJ0q-2FF-2BV3rt1updqnxYlychJR-2BrxZPi0U9wjHq9p4AH3ys-2BYDzrFjajNsbSahaZFujVMoZaQz7eJu4lg-2FHO2m2SU87s2p5kcq4CTTitYYn3fyVEp8qKuhd5rvXuClipbHR5sl7hN-2FbCZbMdzmhS2OxAkqe4SuxwbogpRkFmJGaw-3D-3D">Paper</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.nature.com/articles/s41558-020-0791-3">Comment</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.nature.com/articles/s41558-020-0792-2.epdf?sharing_token=0jD1JVoPl_7PZVgyUP74aNRgN0jAjWel9jnR3ZoTv0NEKVNoLOaLnn7fOjqRFq6Ji_BTSafl_-HrlVWUiE75uV0Ff9kc-ZK36llJ35pH6NM7OdBr3Ufc8aDRTgsD5CxJwZP5g19DfXFIRAgyfv2G712uxwREei87BGfGcUNLSFg%3D">Response</a></li>
<li>Selected media: <a href="https://www.theatlantic.com/science/archive/2018/07/high-temperatures-cause-suicide-rates-to-increase/565826/">The Atlantic</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.theguardian.com/environment/2018/jul/23/rising-temperatures-linked-to-increased-suicide-rates">The Guardian</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.reuters.com/article/us-usa-climatechange-suicide/rising-heat-linked-to-suicide-spikes-in-us-and-mexico-idUSKBN1KD1WR">Reuters</a></li>
</ul></li>
<li>Weather Impacts Expressed Sentiment (with Nick Obradovich, Yury Kryvasheyeu, Haohui Chen, Lorenzo Coviello, Esteban Moro, Manuel Cebrian, and James H. Fowler, <em>PLOS ONE</em>, 2018)
<ul>
<li><a href="http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0195750">Paper</a></li>
<li>Selected media: <a href="https://www.technologyreview.com/s/608961/billion-tweet-study-proves-we-write-happier-messages-when-the-weather-is-good/">MIT Technology Review</a></li>
</ul></li>
<li>Climate Change is Projected to Have Severe Impacts on the Frequency and Intensity of Peak Electricity Demand Across the United States (with Max Auffhammer and Catherine H. Hausman, <em>Proceedings of the National Academy of Sciences</em>, 2017)
<ul>
<li><a href="http://www.pnas.org/content/114/8/1886.full">Paper</a></li>
<li>Selected media: <a href="https://www.nytimes.com/interactive/2017/06/22/climate/95-degree-day-maps.html">New York Times</a> <span class="math inline">\(\cdot\)</span> <a href="https://arstechnica.com/science/2017/02/us-electric-grid-isnt-ready-to-handle-our-future-climate/">ARS Technica</a></li>
</ul></li>
</ul>
</section>
<section id="working-papers" class="level2">
<h2 class="anchored" data-anchor-id="working-papers">Working papers</h2>
<ul>
<li>Does Time Shift Behavior? The Clock- vs.&nbsp;Solar-time Tradeoff (with Severin Borenstein and Ed Rubin)
<ul>
<li><a href="./pdf/time-behavior.pdf">Working Paper</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.nber.org/papers/w30999">NBER Working Paper (March 2023)</a> <span class="math inline">\(\cdot\)</span> <a href="https://energyathaas.wordpress.com/2023/03/06/does-anybody-really-care-what-time-it-is/">Blog post</a></li>
</ul></li>
<li>Is the Demand for Clean Air Too Low? Experimental Evidence from Delhi (with Michael Greenstone, Kenneth Lee, and Harshil Sahai)
<ul>
<li><a href="./pdf/masks.pdf">Working Paper</a></li>
</ul></li>
<li>Climate and Migration in the United States (with Prashant Bharadwaj, Jamie Mullins, and Nick Obradovich, under submission)
<ul>
<li><a href="./pdf/climate-migration.pdf">Working Paper</a></li>
</ul></li>
<li>Incentivizing Self-Protection from Wildfires (with Judson Boomhower and Bob Horton)
<ul>
<li><a href="./pdf/dspace-rct.pdf">Working Paper</a> <span class="math inline">\(\cdot\)</span> <a href="https://www.povertyactionlab.org/blog/5-10-24/building-research-partnerships-address-wildfire-risk-jackson-county-oregon">J-PAL blog post</a></li>
</ul></li>
</ul>
</section>
<section id="selected-work-in-progress" class="level2">
<h2 class="anchored" data-anchor-id="selected-work-in-progress">Selected work in progress</h2>
<ul>
<li>Labor Lock-in in the Fossil Fuel Industry (with Eva Lyubich and Katherine Wagner)</li>
<li>The Economic Consequences of Property Destruction (with Judson Boomhower, Jonathan Colmer and John Voorheis)</li>
<li>Barriers to Civic Action on Clean Air (with Shweta Bhogale and Teevrat Garg)</li>
<li>Adaptation and Insurance in the Agriculture Sector (with Talha Naeem, and Guglielmo Zappala)</li>
</ul>
<!-- - Use IRA and BIL Programs to Build an Evidence Base for Effective Decarbonization Strategies (with Peter Christensen, Teevrat Garg, Shanjun Li, Gordon McCord, Erich Muehlegger, Erica Myers, Emma Noble Smith, David S. Rapson) -->
<!-- - Heat and Longevity (with Munir Squires) -->
<!-- - Requiring Defensible Space (with Tamma Carleton and Robert Heilmeyr) -->


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>