{
  "hash": "ea475b7d79350fc1c53685151393da0e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Overlaying a raster and shapefile\"\ndescription: \"A quick example of how to plot a raster and shapefile overlay in R\"\nauthor: \"Patrick Baylis\"\ndate: 2020-07-03\ndraft: false\nformat: \n  html:\n    page-layout: full\ncategories:\n  - R\n  - spatial\n---\n\n::: {.callout-note}\n# 2025 Update\n\nI've updated this post to use a different raster dataset (the National Burned Area Composite) and the `bcmaps` package to get a shapefile of British Columbia. The basic approach is the same, though the code has been modernized a bit.\n:::\n\nI'm often overlaying rasters with shapefiles in order to get, for example, the area burned in BC over the last 40+ years. I've found that it's very important that I **map my data** when I'm doing this sort of thing, to make sure that I'm not making any boneheaded mistakes (e.g., using the wrong projection). \n\nHere's an example of a map like that, where the color of the cells indicates whether or not we have data there, plus the code I used to create it. You'll need to download the raster file yourself (see comments in code).\n\n![BC Burned Area Overlay (1972-2024)](map.png)\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(raster, tidyverse, sf, cowplot, ncdf4, bcmaps)\n\n# Load 250m National Burned Area Composite\n# HTML Source: https://cwfis.cfs.nrcan.gc.ca/ha/nfdb?type=nbac&year=9999\n# Source: https://cwfis.cfs.nrcan.gc.ca/downloads/nbac/NBAC_MRB_1972to2024_250m.tif.zip\nnbac_rast <- raster(\"~/Downloads/NBAC_MRB_1972to2024_250m.tif/NBAC_MRB_1972to2024_250m.tif\")\n\n# Load a shapefile of BC and transform to raster CRS\nbc_rd <- bc_bound() %>% st_transform(proj4string(nbac_rast))\n\n# Crop raster to extent of BC\nnbac_rast <- crop(nbac_rast, extent(bc_rd))\n\n# Downsample raster for faster plotting\nnbac_rast <- aggregate(nbac_rast, fact = 10)\n\nnbac_rast <- as.data.frame(nbac_rast, xy = TRUE)\nnames(nbac_rast)[3] <- \"value\"\nnbac_rast <- nbac_rast %>% \n  mutate(data_present = factor(!is.na(value), levels = c(FALSE, TRUE), labels = c(\"No\", \"Yes\")))\n\n# Make a plot with the shapefile and boxes for the raster cells, where gray cells indicate no data.\np <- ggplot(data = nbac_rast) + \n  geom_sf(data = bc_rd, fill = NA, colour = \"black\") + \n  geom_tile(data = nbac_rast, mapping = aes(x = x, y = y, fill = data_present), alpha = 0.5) + \n  scale_fill_viridis_d(name = \"Burned? (1972-2024)\", labels = c(\"No\", \"Yes\"), option = \"E\") +\n  theme_map() \n\nsave_plot(\"map.png\", plot = p)\n```\n:::\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}